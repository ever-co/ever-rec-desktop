<!-- video.component.html -->
@if (video) {
<mat-card
  appearance="outlined"
  class="transform h-full transition-transform duration-300 scale-[0.99] hover:scale-[1.00]"
>
  <div class="relative h-full group">
    <video
      #videoPlayer
      mat-card-image
      [src]="video.pathname"
      alt="Video"
      class="w-full h-full object-cover rounded-t-lg"
      [controls]="controls"
    >
      <source [src]="video.pathname" type="video/mp4" />
      <p class="text-gray-500">Your browser does not support the video tag.</p>
    </video>

    @if(!controls){
    <div
      [ngClass]="{ 'bg-opacity-20': checked }"
      class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 rounded-t-lg"
    >
      <div
        [ngClass]="{ 'opacity-100': checked }"
        class="absolute p-1 bg-gradient-to-t from-black/80 to-transparent h-full w-full justify-between items-start flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
      >
        <div
          class="flex items-start flex flex-col justify-between h-full group"
        >
          <mat-checkbox
            [checked]="checked"
            (change)="onSelected($event.checked)"
            [color]="'primary'"
            class="relative text-white transition-all duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-gray-900 rounded group-hover:text-blue-400"
          >
          </mat-checkbox>
          @if (video.metadata) {
          <div class="flex gap-1 p-2">
            <mat-icon class="text-white">
              {{ video.metadata.resolution | resolution : 'icon' }}
            </mat-icon>
            <span class="text-white">{{
              video.metadata.duration | humanize : 's' : 'hh:mm:ss.SS'
            }}</span>
          </div>
          }
        </div>
        <div class="flex flex-col justify-between h-full">
          <button [libPopover]="menu" mat-icon-button class="bg-black">
            <mat-icon class="text-white hover:text-blue-400 transition-colors"
              >more_vert</mat-icon
            >
          </button>
          <button (click)="fullscreen()" mat-icon-button class="bg-black">
            <mat-icon class="text-white hover:text-blue-400 transition-colors"
              >fullscreen</mat-icon
            >
          </button>
        </div>
      </div>
    </div>
    }
  </div>

  @if(!controls){
  <mat-card-content class="p-4">
    <div class="flex items-center gap-4">
      <button
        mat-icon-button
        (click)="togglePlayPause()"
        class="bg-primary-100 hover:bg-primary-200 transition-colors duration-200"
      >
        <mat-icon class="text-primary-600">{{
          (played$ | async) ? 'pause' : 'play_arrow'
        }}</mat-icon>
      </button>
      <div class="flex-1 mt-4 min-w-0">
        @if(video.metadata?.name) {
        <div class="text-lg font-medium text-gray-900 truncate">
          {{ video.metadata?.name }}
        </div>
        }
        <p class="text-sm text-gray-500 truncate">
          {{ video.createdAt | utcToLocalTime }}
        </p>
      </div>
    </div>
  </mat-card-content>
  }
</mat-card>

<ng-template #menu>
  <lib-action-button-group
    [data]="video"
    [buttons]="actionButtons"
  ></lib-action-button-group>
</ng-template>
}
