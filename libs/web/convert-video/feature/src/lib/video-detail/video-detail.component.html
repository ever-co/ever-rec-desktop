@if (video$ | async; as video) {
<div class="max-w-7xl mx-auto bg-white rounded-df max-h-custom overflow-auto">
  <div class="flex flex-col lg:flex-row">
    <!-- Video Player Section -->
    <div class="w-full lg:w-2/3 p-4">
      <div class="aspect-w-16 aspect-h-9 overflow-hidden">
        <lib-video
          [controls]="true"
          [video]="video"
          class="w-full h-full object-cover"
        ></lib-video>
      </div>
      <div class="mt-6">
        <div
          class="text-2xl mb-2 font-bold text-gray-800 truncate relative group"
        >
          <!-- Display Mode -->
          @if(!isEditing){
          <div
            class="cursor-pointer hover:text-indigo-500"
            (click)="isEditing = true"
          >
            {{ video.metadata?.name || 'Untitled Video' }}
          </div>
          }

          <!-- Edit Mode -->
          @if(isEditing){
          <mat-form-field appearance="outline" class="w-full">
            <input
              matInput
              #title
              [value]="video.metadata?.name"
              (blur)="isEditing = false"
              (keydown.enter)="
                isEditing = false; onTitleChange(title.value, video)
              "
              class="text-2xl font-bold"
              autofocus
            />
            <!-- Suffix Icon for Confirm -->
            <button mat-icon-button matPrefix tabindex="-1">
              <mat-icon>edit</mat-icon>
            </button>
          </mat-form-field>
          }
        </div>
        <div class="text-xl font-bold flex justify-between text-gray-600 mb-2">
          <span>Summary</span>
          @if(area.value) {
          <span [libCopyToClipboard]="area.value"></span>
          }
        </div>
        <mat-form-field appearance="outline" class="w-full">
          <textarea
            [value]="video.metadata?.summary"
            #area
            (input)="onSummaryChange(area.value, video)"
            matInput
            rows="3"
          ></textarea>
        </mat-form-field>
      </div>
    </div>

    <!-- Metadata Section -->
    <div class="w-full lg:w-1/3 bg-gray-100 p-4">
      <div class="flex justify-between items-center mb-4">
        <div class="text-xl font-bold text-gray-600">Video Details</div>
        <button
          [libPopover]="menu"
          mat-icon-button
          class="text-gray-500 hover:text-gray-700 transition-colors"
        >
          <mat-icon>more_vert</mat-icon>
        </button>
      </div>

      @if(video.audio) {
      <div class="mb-4">
        <lib-audio [audio]="video.audio"></lib-audio>
      </div>
      } @if(video.metadata) {
      <div class="space-y-4">
        <!-- File Info -->
        <div class="bg-white rounded-df p-4">
          <div class="flex items-center justify-between mb-4">
            <span class="text-lg font-semibold text-gray-600">File Info</span>
            <mat-icon class="text-blue-500">description</mat-icon>
          </div>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">Name</span>
              <span
                class="text-sm text-right font-medium text-gray-800 w-3/4 truncate"
                >{{ video.metadata.name }}</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">Created</span>
              <span class="text-sm font-medium text-gray-800">{{
                video.metadata.createdAt | date : 'MMM d, y â€¢ h:mm a'
              }}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">Uploaded</span>
              <div class="text-sm font-medium">
                <mat-icon
                  class="cursor-pointer"
                  [matTooltip]="video.synced ? 'Synced' : 'Not Synced'"
                  [ngClass]="{
                    'text-red-500': !video.synced,
                    'text-green-500': video.synced
                  }"
                >
                  {{ video.synced ? 'cloud_done' : 'cloud_off' }}
                </mat-icon>
              </div>
            </div>
          </div>
        </div>

        <!-- Technical Details -->
        <div class="bg-white rounded-df p-4">
          <div class="flex items-center justify-between mb-4">
            <span class="text-lg font-semibold text-gray-600"
              >Technical Details</span
            >
            <mat-icon class="text-green-500">settings</mat-icon>
          </div>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">Codec</span>
              <span class="text-sm font-medium text-gray-800">{{
                video.metadata.codec
              }}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">Frame Rate</span>
              <span class="text-sm font-medium text-gray-800"
                >{{ video.metadata.frameRate }} FPS</span
              >
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">Resolution</span>
              <mat-icon [matTooltip]="video.metadata.resolution | resolution">
                {{ video.metadata.resolution | resolution : 'icon' }}
              </mat-icon>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">Batch</span>
              <span class="text-sm font-medium text-gray-800">{{
                video.metadata.batch
              }}</span>
            </div>
          </div>
        </div>

        <!-- Additional Info -->
        <div class="bg-white rounded-df p-4">
          <div class="flex items-center justify-between mb-4">
            <span class="text-lg font-semibold text-gray-600"
              >Additional Info</span
            >
            <mat-icon class="text-purple-500">info</mat-icon>
          </div>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">Size</span>
              <span class="text-sm font-medium text-gray-800">{{
                video.metadata.size | humanizeBytes
              }}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">Duration</span>
              <span class="text-sm font-medium text-gray-800">{{
                video.metadata.duration
                  | humanize
                    : 's'
                    : 'h[h] m[min] s[sec] SS[ms]'
                    : { trim: true }
              }}</span>
            </div>
          </div>
        </div>
      </div>
      }
    </div>
  </div>
</div>

<ng-template #menu>
  <lib-action-button-group
    [data]="video"
    [buttons]="actionButtons"
  ></lib-action-button-group>
</ng-template>
} @else {
<div
  class="min-h-screen flex justify-center items-center bg-gradient-to-br from-gray-50 to-gray-100"
>
  <div class="bg-white p-4 rounded-df shadow-xl">
    <lib-no-data class="text-gray-700" message="No video available">
    </lib-no-data>
  </div>
</div>
}
