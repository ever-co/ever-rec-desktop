@let user = user$ | async;
@let fullNameUpdating = fullNameUpdating$ | async;
@let emailUpdating = emailUpdating$ | async;
@let emailError = emailError$ | async;
@let fullNameError = fullNameError$ | async;
@let passwordError = passwordError$ | async;

<div class="flex flex-col gap-4 max-w-xl w-md w-full">
  <div class="flex flex-col sm:flex-row gap-6">
    <div class="flex flex-col items-center gap-3">
      <lib-user-avatar
        [show-tooltip]="false"
        [show-name]="false"
        [show-email]="false"
        [user]="user"
        size="xl"
      ></lib-user-avatar>
      <div class="text-blue-900 text-sm cursor-pointer">Edit</div>
    </div>
    <div class="w-full">
      <mat-accordion class="profile-headers-align mat-elevation-0" multi>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title> Name </mat-panel-title>
            <mat-panel-description>
              {{ user?.name }}
              <mat-icon>account_circle</mat-icon>
            </mat-panel-description>
          </mat-expansion-panel-header>

          @if (fullNameError) {
            <div
              class="p-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400 mb-3"
            >
              {{ fullNameError }}
            </div>
          }

          <lib-name-form
            [name]="user?.name ?? ''"
            [loading]="fullNameUpdating"
            (nameChange)="updateName($event)"
          ></lib-name-form>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title> Email </mat-panel-title>
            <mat-panel-description>
              {{ user?.email }}
              <mat-icon>email</mat-icon>
            </mat-panel-description>
          </mat-expansion-panel-header>

          @if (emailError) {
            <div
              class="p-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400 mb-3"
            >
              {{ emailError }}
            </div>
          }

          <lib-email-form
            [input]="user?.email ?? ''"
            [loading]="emailUpdating"
            (emailChange)="updateEmail($event)"
          ></lib-email-form>
        </mat-expansion-panel>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title> Password </mat-panel-title>
            <mat-panel-description>
              ***
              <mat-icon>security</mat-icon>
            </mat-panel-description>
          </mat-expansion-panel-header>

          @if (passwordError) {
            <div
              class="p-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400 mb-3"
            >
              {{ passwordError }}
            </div>
          }

          <lib-password-form
            [config]="passwordConfig"
            (passwordChange)="updatePassword($event)"
          ></lib-password-form>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>
  <mat-divider></mat-divider>
  <div class="flex justify-between align-center items-center">
    <div class="font-medium text-gray-600">Account</div>
    <lib-action-button [button]="deleteButton"></lib-action-button>
  </div>
  <mat-divider></mat-divider>
  <div class="w-fit">
    <lib-action-button
      class="w-fit"
      [button]="signOutButton"
    ></lib-action-button>
  </div>
</div>
